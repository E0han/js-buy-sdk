'use strict';

var rollupPluginutils = require('rollup-pluginutils');
var path = require('path');

/* eslint-env node */

var projectRoot = process.cwd();

function normalizePath(pathToNormalize) {
  if (path.isAbsolute(pathToNormalize)) {
    return rollupPluginutils.addExtension(pathToNormalize);
  }

  return path.join(projectRoot, rollupPluginutils.addExtension(pathToNormalize));
}

function remap(options) {
  if ( options === void 0 ) options = {};

  var fullOriginalPath = normalizePath(options.originalPath);
  var fullTargetPath = normalizePath(options.targetPath);

  return {
    name: 'remap',

    resolveId: function resolveId(importee, importer) {
      if (!importer) {
        return null;
      }

      var fullImportPath;

      if (path.isAbsolute(importee)) {
        fullImportPath = rollupPluginutils.addExtension(importee);
      } else {
        fullImportPath = path.join(path.dirname(normalizePath(importer)), rollupPluginutils.addExtension(importee));
      }

      if (fullImportPath === fullOriginalPath) {
        return fullTargetPath;
      }

      return null;
    }
  };
}

module.exports = remap;
