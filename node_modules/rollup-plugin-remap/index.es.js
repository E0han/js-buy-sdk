import { addExtension } from 'rollup-pluginutils';
import { dirname, isAbsolute, join } from 'path';

/* eslint-env node */

var projectRoot = process.cwd();

function normalizePath(pathToNormalize) {
  if (isAbsolute(pathToNormalize)) {
    return addExtension(pathToNormalize);
  }

  return join(projectRoot, addExtension(pathToNormalize));
}

function remap(options) {
  if ( options === void 0 ) options = {};

  var fullOriginalPath = normalizePath(options.originalPath);
  var fullTargetPath = normalizePath(options.targetPath);

  return {
    name: 'remap',

    resolveId: function resolveId(importee, importer) {
      if (!importer) {
        return null;
      }

      var fullImportPath;

      if (isAbsolute(importee)) {
        fullImportPath = addExtension(importee);
      } else {
        fullImportPath = join(dirname(normalizePath(importer)), addExtension(importee));
      }

      if (fullImportPath === fullOriginalPath) {
        return fullTargetPath;
      }

      return null;
    }
  };
}

export default remap;
